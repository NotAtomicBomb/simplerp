@using Sandbox;
@using Sandbox.UI;
@using System.Collections.Generic;

@namespace MyGame
@inherits RootPanel
@attribute [StyleSheet]
 @if (Hidden == false)
{
    <root>

        <div class="menu-container flex-column">
            <h1 class="center-text header-font">Available Jobs</h1>
            <div class="jobs-container flex-column">
                @foreach (var entry in currentGame.Jobs)
                {
                    if (entry.Value.Name != (Game.LocalPawn as Player).Job.Name)
                    {
                        <div class="job-card flex-column" onclick="@(() => ConsoleSystem.Run("switch_job", entry.Key))">
                            <h3 class="job-text center-text">@entry.Value.Name</h3>
                            <h4 class="center-text">@entry.Value.CurrentNumberOfPlayers/@entry.Value.MaxPlayers</h4>
                        </div>
                    }
                }
            </div>
        </div>
    
    </root>
 }

@code
{
    static JobMenu Instance;
    MyGame currentGame = (GameManager.Current as MyGame);
    bool Hidden { get; set; } = true;


    public void ToggleUI() {

        Hidden = !Hidden;
        Mouse.Position = new Vector2 { x = Screen.Width/2, y = Screen.Height/2 };
        StateHasChanged();
    }

    public override void Tick() {
        base.Tick();

        if (Input.Pressed("jobtoggle")) 
        {
            ToggleUI();
        }

        if(Instance == null)
        {
            Instance = this;
        }

    }

    [ClientRpc]
    public static void UpdateInfo()
    {
        if (Instance != null)
        {
            Instance.StateHasChanged();
        }
    }

}
