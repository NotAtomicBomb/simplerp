@using Sandbox;
@using Sandbox.UI;

@namespace MyGame
@inherits RootPanel
@attribute [StyleSheet]

@if (hidden == false)
{
    <root>
        <div class="playerlist-container center">
            <h1 class="center">Players</h1>
            <div class="line">
                @foreach (Player player in (GameManager.Current as MyGame).Players) {
                    <div class="player-container">
                        <h3>@player.Client.Name</h3>
                        <h3>@player.Client.Ping</h3>
                        <h3>@GetJob(player)</h3>
                    </div>
                }
            </div>
        </div>
    </root>
}

@code
{
    static PlayerList Instance;

    bool hidden = true;

    private string GetJob(Player player)
    {
        return player.Client.GetValue<string>("job").Split(";")[0];
    }

    private void TogglePlayerList()
    {
        hidden = !hidden;
        StateHasChanged();
    }

    public override void Tick()
    {
        base.Tick();

        if (Input.Pressed("playerlisttoggle"))
        {
            TogglePlayerList();
        }

        if (Instance == null)
        {
            Instance = this;
        }
    }

    [ClientRpc]
    public static void UpdateInfo()
    {
        if(Instance != null)
        {
            Instance.StateHasChanged();
        }
    }


}
